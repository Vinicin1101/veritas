{"version":3,"file":"veritas-sdk.cjs.js","sources":["../src/frontend/collector.js","../src/frontend/BehaviorCollector.js","../src/frontend/crypt.js","../src/frontend/utils.js","../src/frontend/index.js","../src/frontend/sender.js"],"sourcesContent":["import { BehaviorCollector } from './BehaviorCollector.js';\n\n// ==================== Helpers ====================\n\nfunction getBrowserInfo() {\n  return {\n    userAgent: navigator.userAgent,\n    language: navigator.language,\n    languages: navigator.languages,\n    cookieEnabled: navigator.cookieEnabled,\n    doNotTrack: navigator.doNotTrack,\n    hardwareConcurrency: navigator.hardwareConcurrency,\n    maxTouchPoints: navigator.maxTouchPoints,\n  };\n}\n\nfunction getScreenInfo() {\n  return {\n    width: window.screen.width,\n    height: window.screen.height,\n    availWidth: window.screen.availWidth,\n    availHeight: window.screen.availHeight,\n    colorDepth: window.screen.colorDepth,\n    pixelDepth: window.screen.pixelDepth,\n    orientation: window.screen.orientation?.type || null,\n    devicePixelRatio: window.devicePixelRatio\n  };\n}\n\nfunction getTimezoneInfo() {\n  return {\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    timezoneOffset: new Date().getTimezoneOffset(),\n    timestamp: Date.now(),\n    locale: navigator.language\n  };\n}\n\nfunction getPlugins() {\n  return Array.from(navigator.plugins || []).map(p => p.name);\n}\n\nfunction getStorageInfo() {\n  return {\n    localStorage: !!window.localStorage,\n    sessionStorage: !!window.sessionStorage,\n    indexedDB: !!window.indexedDB,\n    cookies: navigator.cookieEnabled\n  };\n}\n\nfunction collectFingerprint() {\n  try {\n    const canvas = document.createElement('canvas');\n    const ctx = canvas.getContext('2d');\n    ctx.textBaseline = 'top';\n    ctx.font = \"14px 'Arial'\";\n    ctx.textBaseline = 'alphabetic';\n    ctx.fillStyle = '#f60';\n    ctx.fillRect(125,1,62,20);\n    ctx.fillStyle = '#069';\n    ctx.fillText('fingerprint', 2, 15);\n    ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';\n    ctx.fillText('fingerprint', 4, 17);\n    return canvas.toDataURL();\n  } catch (e) {\n    return 'unavailable';\n  }\n}\n\n// ==================== Main Collector ====================\n\nconst behaviorCollector = new BehaviorCollector();\n\nexport function collectData(options = {}) {\n  if (options.collectBehavior !== false) {\n    behaviorCollector.initListeners();\n  }\n\n  return {\n    timestamp: Date.now(),\n    browser: getBrowserInfo(),\n    fingerprint: options.collectFingerprint !== false ? collectFingerprint() : undefined,\n    timezone: getTimezoneInfo(),\n    plugins: options.collectPlugins !== false ? getPlugins() : undefined,\n    storage: options.collectStorage !== false ? getStorageInfo() : undefined,\n    behavior: options.collectBehavior !== false ? {\n      screen: getScreenInfo(),\n      ...behaviorCollector.getBehavior()\n    } : undefined\n  };\n}\n","export class BehaviorCollector {\n  constructor() {\n    this.mouseEvents = [];\n    this.keyboardEvents = [];\n    this.focusEvents = [];\n    this.scrollEvents = [];\n    this.clickEvents = [];\n    this.listenersInitialized = false;\n  }\n\n  initListeners() {\n    if (this.listenersInitialized || typeof window === 'undefined') return;\n\n    // Mouse\n    window.addEventListener('mousemove', (e) => {\n      this.mouseEvents.push({ x: e.clientX, y: e.clientY, timestamp: Date.now() });\n      if (this.mouseEvents.length > 100) this.mouseEvents.shift();\n    });\n\n    // Teclado\n    window.addEventListener('keydown', (e) => {\n      this.keyboardEvents.push({\n        key: e.key,\n        timestamp: Date.now(),\n        ctrlKey: e.ctrlKey,\n        altKey: e.altKey,\n        shiftKey: e.shiftKey\n      });\n      if (this.keyboardEvents.length > 100) this.keyboardEvents.shift();\n    });\n\n    // Foco\n    window.addEventListener('focus', (e) => {\n      this.focusEvents.push({ type: 'focus', timestamp: Date.now(), target: e.target?.tagName || '' });\n    }, true);\n\n    window.addEventListener('blur', (e) => {\n      this.focusEvents.push({ type: 'blur', timestamp: Date.now(), target: e.target?.tagName || '' });\n    }, true);\n\n    // Scroll\n    window.addEventListener('scroll', () => {\n      this.scrollEvents.push({ x: window.scrollX, y: window.scrollY, timestamp: Date.now() });\n      if (this.scrollEvents.length > 100) this.scrollEvents.shift();\n    });\n\n    // Click\n    window.addEventListener('click', (e) => {\n      this.clickEvents.push({ timestamp: Date.now(), x: e.clientX, y: e.clientY });\n      if (this.clickEvents.length > 100) this.clickEvents.shift();\n    });\n\n    this.listenersInitialized = true;\n  }\n\n  clickFrequency(windowMs = 10000) {\n    const now = Date.now();\n    const recentClicks = this.clickEvents.filter(c => now - c.timestamp <= windowMs);\n    return recentClicks.length / (windowMs / 1000); // cliques por segundo\n  }\n\n  avgClickInterval() {\n    if (this.clickEvents.length < 2) return null;\n    let intervals = [];\n    for (let i = 1; i < this.clickEvents.length; i++) {\n      intervals.push(this.clickEvents[i].timestamp - this.clickEvents[i - 1].timestamp);\n    }\n    return intervals.reduce((a, b) => a + b, 0) / intervals.length;\n  }\n\n  getBehavior() {\n    return {\n      mouseEvents: [...this.mouseEvents],\n      keyboardEvents: [...this.keyboardEvents],\n      focusEvents: [...this.focusEvents],\n      scrollEvents: [...this.scrollEvents],\n      clickEvents: [...this.clickEvents],\n      clickFrequency: this.clickFrequency(),\n      avgClickInterval: this.avgClickInterval()\n    };\n  }\n}\n","import { isNode, isBrowser } from './utils.js';\n\n// HMAC para browser\nasync function browserHmac(message, secret) {\n  if (!crypto || !crypto.subtle) {\n    throw new Error('Web Crypto API não disponível');\n  }\n  \n  const key = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n  \n  const signature = await crypto.subtle.sign(\n    'HMAC',\n    key,\n    new TextEncoder().encode(message)\n  );\n  \n  return btoa(String.fromCharCode(...new Uint8Array(signature)));\n}\n\n// HMAC para Node.js\nasync function nodeHmac(message, secret) {\n  try {\n    let crypto;\n    if (typeof require !== 'undefined') {\n      // CommonJS\n      crypto = require('crypto');\n    } else if (typeof process !== 'undefined' && process.versions?.node) {\n      // ESM\n      crypto = (await import('crypto')).default;\n    }\n    if (crypto?.createHmac) {\n      return crypto.createHmac('sha256', secret).update(message).digest('base64');\n    } else {\n      throw new Error('createHmac não disponível');\n    }\n  } catch (error) {\n    throw new Error('Módulo crypto do Node.js não disponível');\n  }\n}\n\n// Função universal para HMAC\nexport async function createHmac(message, secret) {\n  if (isBrowser()) {\n    return await browserHmac(message, secret);\n  } else if (isNode()) {\n    return nodeHmac(message, secret);\n  } else {\n    throw new Error('Ambiente não suportado para HMAC');\n  }\n}\n\n// Verificação de assinatura\nexport async function verifyHmac(message, signature, secret) {\n  try {\n    const expectedSignature = await createHmac(message, secret);\n    return expectedSignature === signature;\n  } catch (error) {\n    return false;\n  }\n}\n\n","export function isBrowser() {\n  return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n}\n\nexport function isNode() {\n  return typeof process !== 'undefined' && process.versions != null && process.versions.node != null;\n}\n","import { collectData } from './collector.js';\nimport { sendToBackend } from './sender.js';\nexport { createHmac, verifyHmac } from './crypt.js';\n\n\n/**\n * @typedef {Object} CollectOptions\n * @property {boolean} [collectPlugins]\n * @property {boolean} [collectStorage]\n * @property {boolean} [collectBehavior]\n */\n\n// Classe principal da SDK\nexport class Veritas {\n  /**\n   * @param {Object} options\n   * @param {CollectOptions} [options.collectOptions]\n   */\n  constructor(options = {}) {\n    this.options = options;\n    this.collectOptions = { collectPlugins: false, collectStorage: false, collectBehavior: false, ...(options.collectOptions || {}) };\n  }\n\n  /**\n   * @param {CollectOptions} CollectOptions\n   */\n  configureCollect(options = {}) {\n    this.collectOptions = { ...this.collectOptions, ...options };\n  }\n\n  async collect() {\n    return await collectData(this.collectOptions);\n  }\n\n  async send(data) {\n    return await sendToBackend(data, this.options);\n  }\n\n  async collectAndSend() {\n    const data = await this.collect();\n    return await this.send(data);\n  }\n\n  async checkRisk(actionData) {\n    const data = await this.collect();\n    data.action = actionData;\n    const response = await this.send(data);\n    return await response.json();\n  }\n  startAutoCollection() {}\n  stopAutoCollection() {}\n  configure(newOptions) { Object.assign(this.options, newOptions); }\n  destroy() {}\n}\n\n// Função de conveniência\nexport function init(options = {}) {\n  const sdk = new Veritas(options);\n  return sdk;\n}\n\n// Export default para compatibilidade\nexport default Veritas;","import { createHmac } from './crypt.js';\n\nexport async function sendToBackend(data, options) {\n  const signature = await createHmac(JSON.stringify(data), options.secret);\n\n  const response = await fetch(options.endpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-SDK-Signature': signature\n    },\n    body: JSON.stringify(data)\n  });\n\n  return response;\n}\n"],"names":["collectFingerprint","canvas","document","createElement","ctx","getContext","textBaseline","font","fillStyle","fillRect","fillText","toDataURL","e","behaviorCollector","constructor","this","mouseEvents","keyboardEvents","focusEvents","scrollEvents","clickEvents","listenersInitialized","initListeners","window","addEventListener","push","x","clientX","y","clientY","timestamp","Date","now","length","shift","key","ctrlKey","altKey","shiftKey","type","target","tagName","scrollX","scrollY","clickFrequency","windowMs","filter","c","avgClickInterval","intervals","i","reduce","a","b","getBehavior","async","createHmac","message","secret","crypto","subtle","Error","importKey","TextEncoder","encode","name","hash","signature","sign","btoa","String","fromCharCode","Uint8Array","browserHmac","process","versions","node","require","import","default","update","digest","error","nodeHmac","Veritas","options","collectOptions","collectPlugins","collectStorage","collectBehavior","configureCollect","collect","browser","userAgent","navigator","language","languages","cookieEnabled","doNotTrack","hardwareConcurrency","maxTouchPoints","fingerprint","undefined","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","timezoneOffset","getTimezoneOffset","locale","plugins","Array","from","map","p","storage","localStorage","sessionStorage","indexedDB","cookies","behavior","screen","width","height","availWidth","availHeight","colorDepth","pixelDepth","orientation","devicePixelRatio","collectData","send","data","JSON","stringify","fetch","endpoint","method","headers","body","sendToBackend","collectAndSend","checkRisk","actionData","action","response","json","startAutoCollection","stopAutoCollection","configure","newOptions","Object","assign","destroy"],"mappings":"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"}
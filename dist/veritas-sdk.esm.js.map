{"version":3,"file":"veritas-sdk.esm.js","sources":["../src/crypt.js","../src/utils.js","../src/risk.js","../src/index.js","../src/collector.js","../src/sender.js"],"sourcesContent":["import { isNode, isBrowser } from './utils.js';\n\n// Implementação HMAC para browser\nasync function browserHmac(message, secret) {\n  if (!crypto || !crypto.subtle) {\n    throw new Error('Web Crypto API não disponível');\n  }\n  \n  const key = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n  \n  const signature = await crypto.subtle.sign(\n    'HMAC',\n    key,\n    new TextEncoder().encode(message)\n  );\n  \n  return btoa(String.fromCharCode(...new Uint8Array(signature)));\n}\n\n// Implementação HMAC para Node.js\nasync function nodeHmac(message, secret) {\n  try {\n    let crypto;\n    if (typeof require !== 'undefined') {\n      // CommonJS\n      crypto = require('crypto');\n    } else if (typeof process !== 'undefined' && process.versions?.node) {\n      // ESM\n      crypto = (await import('crypto')).default;\n    }\n    if (crypto?.createHmac) {\n      return crypto.createHmac('sha256', secret).update(message).digest('base64');\n    } else {\n      throw new Error('createHmac não disponível');\n    }\n  } catch (error) {\n    throw new Error('Módulo crypto do Node.js não disponível');\n  }\n}\n\n// Função universal para HMAC\nexport async function createHmac(message, secret) {\n  if (isBrowser()) {\n    return await browserHmac(message, secret);\n  } else if (isNode()) {\n    return nodeHmac(message, secret);\n  } else {\n    throw new Error('Ambiente não suportado para HMAC');\n  }\n}\n\n// Verificação de assinatura\nexport async function verifyHmac(message, signature, secret) {\n  try {\n    const expectedSignature = await createHmac(message, secret);\n    return expectedSignature === signature;\n  } catch (error) {\n    return false;\n  }\n}\n\n","export function isBrowser() {\n  return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n}\n\nexport function isNode() {\n  return typeof process !== 'undefined' && process.versions != null && process.versions.node != null;\n}\n","const weights = {\n    canvas: 20,\n    webgl: 15,\n    audio: 5,\n    mouseEvents: 25,\n    keyboardEvents: 20,\n    timezoneUTC: 10,\n    highValuePurchase: 30\n};\n\nexport function evaluateRisk(data) {\n    let score = 0;\n    score += !data.fingerprints?.canvas ? weights.canvas : 0;\n    score += !data.fingerprints?.webgl ? weights.webgl : 0;\n    score += !data.fingerprints?.audio ? weights.audio : 0;\n    score += (data.behavior?.mouseEvents?.length < 5) ? weights.mouseEvents : 0;\n    score += (data.behavior?.keyboardEvents?.length < 3) ? weights.keyboardEvents : 0;\n    score += (data.timezone?.timezone === 'UTC') ? weights.timezoneUTC : 0;\n    score += (data.action?.action === 'purchase' && data.action?.amount > 1000) ? weights.highValuePurchase : 0;\n    return Math.min(100, score);\n}\n\nexport function riskDecision(score, data, threshold = 45) {\n    let decision = 'allow';\n    if (score >= threshold) decision = 'deny';\n    else if (score >= threshold * 0.7) decision = 'review';\n    else decision = 'allow';\n\n    const reasons = [];\n    if (score >= 50) reasons.push('Comportamento suspeito detectado');\n    if (!data.fingerprints?.canvas) reasons.push('Fingerprint de canvas ausente');\n    if (data.action?.amount > 1000) reasons.push('Valor de transação alto');\n    return { decision, reasons };\n}","import { collectData } from './collector.js';\nimport { sendToBackend } from './sender.js';\nexport { createHmac, verifyHmac } from './crypt.js';\nexport { evaluateRisk, riskDecision } from './risk.js';\n\n// Classe principal da SDK\nexport class Veritas {\n  constructor(options = {}) {\n    this.options = options;\n  }\n  collect() { return collectData(); }\n  async send(data) { return sendToBackend(data, this.options); }\n  async collectAndSend() {\n    const data = this.collect();\n    return this.send(data);\n  }\n  async checkRisk(actionData) {\n    const data = this.collect();\n    data.action = actionData;\n    const response = await this.send(data);\n    return await response.json();\n  }\n  startAutoCollection() {}\n  stopAutoCollection() {}\n  configure(newOptions) { Object.assign(this.options, newOptions); }\n  destroy() {}\n}\n\n// Função de conveniência\nexport function init(options = {}) {\n  const sdk = new Veritas(options);\n  return sdk;\n}\n\n// Export default para compatibilidade\nexport default Veritas;","export function collectData() {\n  const mouseMoves = [];\n  const focusEvents = [];\n\n  // Coletar movimentos do mouse\n  window.addEventListener('mousemove', (e) => {\n    mouseMoves.push({ x: e.clientX, y: e.clientY, t: Date.now() });\n    // Limite para não crescer indefinidamente\n    if (mouseMoves.length > 100) mouseMoves.shift();\n  });\n\n  // Coletar eventos de foco\n  window.addEventListener('focus', (e) => {\n    focusEvents.push({ type: 'focus', t: Date.now() });\n  });\n  window.addEventListener('blur', (e) => {\n    focusEvents.push({ type: 'blur', t: Date.now() });\n  });\n\n  return {\n    userAgent: navigator.userAgent,\n    language: navigator.language,\n    screen: {\n      width: window.screen.width,\n      height: window.screen.height,\n    },\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    mouseMoves,\n    focusEvents,\n  };\n}\n","import { createHmac } from './crypt.js';\n\nexport async function sendToBackend(data, options) {\n  const signature = await createHmac(JSON.stringify(data), options.secret);\n\n  const response = await fetch(options.endpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-SDK-Signature': signature\n    },\n    body: JSON.stringify(data)\n  });\n\n  return response;\n}\n"],"names":["async","createHmac","message","secret","window","document","crypto","subtle","Error","key","importKey","TextEncoder","encode","name","hash","signature","sign","btoa","String","fromCharCode","Uint8Array","browserHmac","process","versions","node","require","import","default","update","digest","error","nodeHmac","verifyHmac","weights","evaluateRisk","data","score","fingerprints","canvas","webgl","audio","behavior","mouseEvents","length","keyboardEvents","timezone","action","amount","Math","min","riskDecision","threshold","decision","reasons","push","Veritas","constructor","options","this","collect","mouseMoves","focusEvents","addEventListener","e","x","clientX","y","clientY","t","Date","now","shift","type","userAgent","navigator","language","screen","width","height","Intl","DateTimeFormat","resolvedOptions","timeZone","collectData","send","JSON","stringify","fetch","endpoint","method","headers","body","sendToBackend","collectAndSend","checkRisk","actionData","response","json","startAutoCollection","stopAutoCollection","configure","newOptions","Object","assign","destroy","init"],"mappings":"AA+COA,eAAeC,EAAWC,EAASC,GACxC,GC/CyB,oBAAXC,aAAqD,IAApBA,OAAOC,SDgDpD,aA9CJL,eAA2BE,EAASC,GAClC,IAAKG,SAAWA,OAAOC,OACrB,MAAM,IAAIC,MAAM,iCAGlB,MAAMC,QAAYH,OAAOC,OAAOG,UAC9B,OACA,IAAIC,aAAcC,OAAOT,GACzB,CAAEU,KAAM,OAAQC,KAAM,YACtB,EACA,CAAC,SAGGC,QAAkBT,OAAOC,OAAOS,KACpC,OACAP,GACA,IAAIE,aAAcC,OAAOV,IAG3B,OAAOe,KAAKC,OAAOC,gBAAgB,IAAIC,WAAWL,IACpD,CA0BiBM,CAAYnB,EAASC,GAC7B,GC7CmB,oBAAZmB,SAA+C,MAApBA,QAAQC,UAA6C,MAAzBD,QAAQC,SAASC,KD8CpF,OAzBJxB,eAAwBE,EAASC,GAC/B,IACE,IAAIG,EAQJ,GAPuB,oBAAZmB,QAETnB,EAASmB,QAAQ,UACW,oBAAZH,SAA2BA,QAAQC,UAAUC,OAE7DlB,SAAgBoB,OAAO,WAAWC,SAEhCrB,GAAQL,WACV,OAAOK,EAAOL,WAAW,SAAUE,GAAQyB,OAAO1B,GAAS2B,OAAO,UAElE,MAAM,IAAIrB,MAAM,4BAEnB,CAAC,MAAOsB,GACP,MAAM,IAAItB,MAAM,0CACpB,CACA,CAOWuB,CAAS7B,EAASC,GAEzB,MAAM,IAAIK,MAAM,mCAEpB,CAGOR,eAAegC,EAAW9B,EAASa,EAAWZ,GACnD,IAEE,aADgCF,EAAWC,EAASC,KACvBY,CAC9B,CAAC,MAAOe,GACP,OAAO,CACX,CACA,CEjEA,MAAMG,EACM,GADNA,EAEK,GAFLA,EAGK,EAHLA,EAIW,GAJXA,EAKc,GALdA,EAMW,GANXA,EAOiB,GAGhB,SAASC,EAAaC,GACzB,IAAIC,EAAQ,EAQZ,OAPAA,GAAUD,EAAKE,cAAcC,OAA0B,EAAjBL,EACtCG,GAAUD,EAAKE,cAAcE,MAAwB,EAAhBN,EACrCG,GAAUD,EAAKE,cAAcG,MAAwB,EAAhBP,EACrCG,GAAUD,EAAKM,UAAUC,aAAaC,OAAS,EAAKV,EAAsB,EAC1EG,GAAUD,EAAKM,UAAUG,gBAAgBD,OAAS,EAAKV,EAAyB,EAChFG,GAAsC,QAA5BD,EAAKU,UAAUA,SAAsBZ,EAAsB,EACrEG,GAAkC,aAAxBD,EAAKW,QAAQA,QAAyBX,EAAKW,QAAQC,OAAS,IAAQd,EAA4B,EACnGe,KAAKC,IAAI,IAAKb,EACzB,CAEO,SAASc,EAAad,EAAOD,EAAMgB,EAAY,IAClD,IAAIC,EAAW,QACSA,EAApBhB,GAASe,EAAsB,OAC1Bf,GAAqB,GAAZe,EAA4B,SAC9B,QAEhB,MAAME,EAAU,GAIhB,OAHIjB,GAAS,IAAIiB,EAAQC,KAAK,oCACzBnB,EAAKE,cAAcC,QAAQe,EAAQC,KAAK,iCACzCnB,EAAKW,QAAQC,OAAS,KAAMM,EAAQC,KAAK,2BACtC,CAAEF,WAAUC,UACvB,CC3BO,MAAME,EACX,WAAAC,CAAYC,EAAU,IACpBC,KAAKD,QAAUA,CACnB,CACE,OAAAE,GAAY,OCVP,WACL,MAAMC,EAAa,GACbC,EAAc,GAiBpB,OAdAzD,OAAO0D,iBAAiB,aAAcC,IACpCH,EAAWN,KAAK,CAAEU,EAAGD,EAAEE,QAASC,EAAGH,EAAEI,QAASC,EAAGC,KAAKC,QAElDV,EAAWjB,OAAS,KAAKiB,EAAWW,WAI1CnE,OAAO0D,iBAAiB,SAAUC,IAChCF,EAAYP,KAAK,CAAEkB,KAAM,QAASJ,EAAGC,KAAKC,WAE5ClE,OAAO0D,iBAAiB,QAASC,IAC/BF,EAAYP,KAAK,CAAEkB,KAAM,OAAQJ,EAAGC,KAAKC,WAGpC,CACLG,UAAWC,UAAUD,UACrBE,SAAUD,UAAUC,SACpBC,OAAQ,CACNC,MAAOzE,OAAOwE,OAAOC,MACrBC,OAAQ1E,OAAOwE,OAAOE,QAExBjC,SAAUkC,KAAKC,iBAAiBC,kBAAkBC,SAClDtB,aACAC,cAEJ,CDpBqBsB,EAAc,CACjC,UAAMC,CAAKjD,GAAQ,OETdnC,eAA6BmC,EAAMsB,GACxC,MAAM1C,QAAkBd,EAAWoF,KAAKC,UAAUnD,GAAOsB,EAAQtD,QAWjE,aATuBoF,MAAM9B,EAAQ+B,SAAU,CAC7CC,OAAQ,OACRC,QAAS,CACP,eAAgB,mBAChB,kBAAmB3E,GAErB4E,KAAMN,KAAKC,UAAUnD,IAIzB,CFJ4ByD,CAAczD,EAAMuB,KAAKD,QAAS,CAC5D,oBAAMoC,GACJ,MAAM1D,EAAOuB,KAAKC,UAClB,OAAOD,KAAK0B,KAAKjD,EACrB,CACE,eAAM2D,CAAUC,GACd,MAAM5D,EAAOuB,KAAKC,UAClBxB,EAAKW,OAASiD,EACd,MAAMC,QAAiBtC,KAAK0B,KAAKjD,GACjC,aAAa6D,EAASC,MAC1B,CACE,mBAAAC,GAAsB,CACtB,kBAAAC,GAAqB,CACrB,SAAAC,CAAUC,GAAcC,OAAOC,OAAO7C,KAAKD,QAAS4C,EAAY,CAChE,OAAAG,GAAU,EAIL,SAASC,EAAKhD,EAAU,IAE7B,OADY,IAAIF,EAAQE,EAE1B"}
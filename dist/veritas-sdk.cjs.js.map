{"version":3,"file":"veritas-sdk.cjs.js","sources":["../src/collector.js","../src/crypt.js","../src/utils.js","../src/index.js","../src/sender.js"],"sourcesContent":["let mouseEvents = [];\nlet keyboardEvents = [];\nlet focusEvents = [];\nlet scrollEvents = [];\n\nlet listenersInitialized = false;\n\n// Funções auxiliares\nfunction getBrowserInfo() {\n  return {\n    userAgent: navigator.userAgent,\n    language: navigator.language,\n    languages: navigator.languages,\n    platform: navigator.platform,\n    cookieEnabled: navigator.cookieEnabled,\n    doNotTrack: navigator.doNotTrack,\n    hardwareConcurrency: navigator.hardwareConcurrency,\n    maxTouchPoints: navigator.maxTouchPoints,\n    vendor: navigator.vendor,\n    vendorSub: navigator.vendorSub\n  };\n}\n\nfunction getScreenInfo() {\n  return {\n    width: window.screen.width,\n    height: window.screen.height,\n    availWidth: window.screen.availWidth,\n    availHeight: window.screen.availHeight,\n    colorDepth: window.screen.colorDepth,\n    pixelDepth: window.screen.pixelDepth,\n    orientation: window.screen.orientation?.type || null,\n    devicePixelRatio: window.devicePixelRatio\n  };\n}\n\nfunction getTimezoneInfo() {\n  return {\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    timezoneOffset: new Date().getTimezoneOffset(),\n    timestamp: Date.now(),\n    locale: navigator.language\n  };\n}\n\nfunction getPlugins() {\n  return Array.from(navigator.plugins || []).map(p => p.name);\n}\n\nfunction getStorageInfo() {\n  return {\n    localStorage: !!window.localStorage,\n    sessionStorage: !!window.sessionStorage,\n    indexedDB: !!window.indexedDB,\n    cookies: navigator.cookieEnabled\n  };\n}\n\nfunction getBehavior() {\n  return {\n    mouseEvents: [...mouseEvents],\n    keyboardEvents: [...keyboardEvents],\n    focusEvents: [...focusEvents],\n    scrollEvents: [...scrollEvents]\n  };\n}\n\n// Função principal de coleta\nexport function collectData(options = {}) {\n  if (!listenersInitialized && typeof window !== 'undefined' && options.collectBehavior !== false) {\n    // Mouse\n    window.addEventListener('mousemove', (e) => {\n      mouseEvents.push({ x: e.clientX, y: e.clientY, timestamp: Date.now() });\n      if (mouseEvents.length > 100) mouseEvents.shift();\n    });\n    // Teclado\n    window.addEventListener('keydown', (e) => {\n      keyboardEvents.push({\n        key: e.key,\n        timestamp: Date.now(),\n        ctrlKey: e.ctrlKey,\n        altKey: e.altKey,\n        shiftKey: e.shiftKey\n      });\n      if (keyboardEvents.length > 100) keyboardEvents.shift();\n    });\n    // Foco\n    window.addEventListener('focus', (e) => {\n      focusEvents.push({ type: 'focus', timestamp: Date.now(), target: e.target?.tagName || '' });\n    }, true);\n    window.addEventListener('blur', (e) => {\n      focusEvents.push({ type: 'blur', timestamp: Date.now(), target: e.target?.tagName || '' });\n    }, true);\n    // Scroll\n    window.addEventListener('scroll', (e) => {\n      scrollEvents.push({ x: window.scrollX, y: window.scrollY, timestamp: Date.now() });\n      if (scrollEvents.length > 100) scrollEvents.shift();\n    });\n\n    listenersInitialized = true;\n  }\n\n  return {\n    timestamp: Date.now(),\n    browser: getBrowserInfo(),\n    screen: getScreenInfo(),\n    timezone: getTimezoneInfo(),\n    plugins: options.collectPlugins !== false ? getPlugins() : undefined,\n    storage: options.collectStorage !== false ? getStorageInfo() : undefined,\n    behavior: options.collectBehavior !== false ? getBehavior() : undefined\n  };\n}\n","import { isNode, isBrowser } from './utils.js';\n\n// HMAC para browser\nasync function browserHmac(message, secret) {\n  if (!crypto || !crypto.subtle) {\n    throw new Error('Web Crypto API não disponível');\n  }\n  \n  const key = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n  \n  const signature = await crypto.subtle.sign(\n    'HMAC',\n    key,\n    new TextEncoder().encode(message)\n  );\n  \n  return btoa(String.fromCharCode(...new Uint8Array(signature)));\n}\n\n// HMAC para Node.js\nasync function nodeHmac(message, secret) {\n  try {\n    let crypto;\n    if (typeof require !== 'undefined') {\n      // CommonJS\n      crypto = require('crypto');\n    } else if (typeof process !== 'undefined' && process.versions?.node) {\n      // ESM\n      crypto = (await import('crypto')).default;\n    }\n    if (crypto?.createHmac) {\n      return crypto.createHmac('sha256', secret).update(message).digest('base64');\n    } else {\n      throw new Error('createHmac não disponível');\n    }\n  } catch (error) {\n    throw new Error('Módulo crypto do Node.js não disponível');\n  }\n}\n\n// Função universal para HMAC\nexport async function createHmac(message, secret) {\n  if (isBrowser()) {\n    return await browserHmac(message, secret);\n  } else if (isNode()) {\n    return nodeHmac(message, secret);\n  } else {\n    throw new Error('Ambiente não suportado para HMAC');\n  }\n}\n\n// Verificação de assinatura\nexport async function verifyHmac(message, signature, secret) {\n  try {\n    const expectedSignature = await createHmac(message, secret);\n    return expectedSignature === signature;\n  } catch (error) {\n    return false;\n  }\n}\n\n","export function isBrowser() {\n  return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n}\n\nexport function isNode() {\n  return typeof process !== 'undefined' && process.versions != null && process.versions.node != null;\n}\n","import { collectData } from './collector.js';\nimport { sendToBackend } from './sender.js';\nexport { createHmac, verifyHmac } from './crypt.js';\n\n/**\n * @typedef {Object} CollectOptions\n * @property {boolean} [collectPlugins]\n * @property {boolean} [collectStorage]\n * @property {boolean} [collectBehavior]\n */\n\n// Classe principal da SDK\nexport class Veritas {\n  /**\n   * @param {Object} options\n   * @param {CollectOptions} [options.collectOptions]\n   */\n  constructor(options = {}) {\n    this.options = options;\n    this.collectOptions = { collectPlugins: false, collectStorage: false, collectBehavior: false, ...(options.collectOptions || {}) };\n  }\n\n  /**\n   * @param {CollectOptions} options\n   */\n  configureCollect(options = {}) {\n    this.collectOptions = { ...this.collectOptions, ...options };\n  }\n\n  async collect() {\n    return await collectData(this.collectOptions);\n  }\n\n  async send(data) {\n    return await sendToBackend(data, this.options);\n  }\n\n  async collectAndSend() {\n    const data = await this.collect();\n    return await this.send(data);\n  }\n\n  async checkRisk(actionData) {\n    const data = await this.collect();\n    data.action = actionData;\n    const response = await this.send(data);\n    return await response.json();\n  }\n  startAutoCollection() {}\n  stopAutoCollection() {}\n  configure(newOptions) { Object.assign(this.options, newOptions); }\n  destroy() {}\n}\n\n// Função de conveniência\nexport function init(options = {}) {\n  const sdk = new Veritas(options);\n  return sdk;\n}\n\n// Export default para compatibilidade\nexport default Veritas;","import { createHmac } from './crypt.js';\n\nexport async function sendToBackend(data, options) {\n  const signature = await createHmac(JSON.stringify(data), options.secret);\n\n  const response = await fetch(options.endpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-SDK-Signature': signature\n    },\n    body: JSON.stringify(data)\n  });\n\n  return response;\n}\n"],"names":["mouseEvents","keyboardEvents","focusEvents","scrollEvents","listenersInitialized","async","createHmac","message","secret","window","document","crypto","subtle","Error","key","importKey","TextEncoder","encode","name","hash","signature","sign","btoa","String","fromCharCode","Uint8Array","browserHmac","process","versions","node","require","import","default","update","digest","error","nodeHmac","Veritas","constructor","options","this","collectOptions","collectPlugins","collectStorage","collectBehavior","configureCollect","collect","addEventListener","e","push","x","clientX","y","clientY","timestamp","Date","now","length","shift","ctrlKey","altKey","shiftKey","type","target","tagName","scrollX","scrollY","browser","userAgent","navigator","language","languages","platform","cookieEnabled","doNotTrack","hardwareConcurrency","maxTouchPoints","vendor","vendorSub","screen","width","height","availWidth","availHeight","colorDepth","pixelDepth","orientation","devicePixelRatio","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","timezoneOffset","getTimezoneOffset","locale","plugins","Array","from","map","p","undefined","storage","localStorage","sessionStorage","indexedDB","cookies","behavior","collectData","send","data","JSON","stringify","fetch","endpoint","method","headers","body","sendToBackend","collectAndSend","checkRisk","actionData","action","response","json","startAutoCollection","stopAutoCollection","configure","newOptions","Object","assign","destroy"],"mappings":"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"}
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Veritas={})}(this,(function(t){"use strict";function e(t,e){let o;return function(...n){clearTimeout(o),o=setTimeout((()=>{clearTimeout(o),t(...n)}),e)}}function o(){return"undefined"==typeof window&&"undefined"!=typeof global}function n(){return"undefined"!=typeof window&&"undefined"!=typeof document}function i(t){let e=0;if(0===t.length)return e;for(let o=0;o<t.length;o++){e=(e<<5)-e+t.charCodeAt(o),e&=e}return Math.abs(e).toString(36)}class s{constructor(){this.mouseEvents=[],this.keyboardEvents=[],this.focusEvents=[],this.scrollEvents=[],this.sessionData={},n()&&this.initBrowserCollectors()}initBrowserCollectors(){const t=e((t=>{this.mouseEvents.push({x:t.clientX,y:t.clientY,timestamp:Date.now()}),this.mouseEvents.length>50&&(this.mouseEvents=this.mouseEvents.slice(-50))}),100),o=e((t=>{this.keyboardEvents.push({key:1===t.key.length?"char":t.key,timestamp:Date.now(),ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey}),this.keyboardEvents.length>30&&(this.keyboardEvents=this.keyboardEvents.slice(-30))}),50),n=t=>{this.focusEvents.push({type:t.type,timestamp:Date.now(),target:t.target.tagName}),this.focusEvents.length>20&&(this.focusEvents=this.focusEvents.slice(-20))},i=e((()=>{this.scrollEvents.push({x:window.scrollX,y:window.scrollY,timestamp:Date.now()}),this.scrollEvents.length>20&&(this.scrollEvents=this.scrollEvents.slice(-20))}),200);document.addEventListener("mousemove",t),document.addEventListener("keydown",o),document.addEventListener("focus",n,!0),document.addEventListener("blur",n,!0),window.addEventListener("scroll",i)}getBrowserInfo(){return n()?{userAgent:navigator.userAgent,language:navigator.language,languages:navigator.languages,platform:navigator.platform,cookieEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,hardwareConcurrency:navigator.hardwareConcurrency,maxTouchPoints:navigator.maxTouchPoints,vendor:navigator.vendor,vendorSub:navigator.vendorSub}:{}}getScreenInfo(){return n()?{width:screen.width,height:screen.height,availWidth:screen.availWidth,availHeight:screen.availHeight,colorDepth:screen.colorDepth,pixelDepth:screen.pixelDepth,orientation:screen.orientation?screen.orientation.type:null,devicePixelRatio:window.devicePixelRatio}:{}}getTimezoneInfo(){const t=new Date;return{timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,timezoneOffset:t.getTimezoneOffset(),timestamp:t.getTime(),locale:Intl.DateTimeFormat().resolvedOptions().locale}}getCanvasFingerprint(){if(!n())return null;try{const t=document.createElement("canvas"),e=t.getContext("2d");e.textBaseline="top",e.font="14px Arial",e.fillText("Veritas SDK Canvas Test üîí",2,2),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillRect(100,5,80,20);return i(t.toDataURL())}catch(t){return null}}getWebGLFingerprint(){if(!n())return null;try{const t=document.createElement("canvas"),e=t.getContext("webgl")||t.getContext("experimental-webgl");if(!e)return null;const o=e.getParameter(e.RENDERER),n=e.getParameter(e.VENDOR),s=e.getParameter(e.VERSION),r=e.getParameter(e.SHADING_LANGUAGE_VERSION);return i(`${o}|${n}|${s}|${r}`)}catch(t){return null}}getAudioFingerprint(){if(!n())return null;try{const t=new(window.AudioContext||window.webkitAudioContext),e=t.createOscillator(),o=t.createAnalyser(),n=t.createGain();e.connect(o),o.connect(n),n.connect(t.destination),e.frequency.value=1e3,n.gain.value=0;const s=`${t.sampleRate}|${t.state}|${o.frequencyBinCount}`;return t.close(),i(s)}catch(t){return null}}getPluginsInfo(){if(!n()||!navigator.plugins)return[];const t=[];for(let e=0;e<navigator.plugins.length;e++){const o=navigator.plugins[e];t.push({name:o.name,description:o.description,filename:o.filename})}return t}getStorageInfo(){if(!n())return{};const t={};try{t.localStorage=!!window.localStorage,t.sessionStorage=!!window.sessionStorage,t.indexedDB=!!window.indexedDB,t.webSQL=!!window.openDatabase}catch(t){}return t}collectAll(){return{sessionId:this.sessionData.sessionId||(this.sessionData.sessionId=Date.now().toString(36)),timestamp:Date.now(),browser:this.getBrowserInfo(),screen:this.getScreenInfo(),timezone:this.getTimezoneInfo(),fingerprints:{canvas:this.getCanvasFingerprint(),webgl:this.getWebGLFingerprint(),audio:this.getAudioFingerprint()},plugins:this.getPluginsInfo(),storage:this.getStorageInfo(),behavior:{mouseEvents:[...this.mouseEvents],keyboardEvents:[...this.keyboardEvents],focusEvents:[...this.focusEvents],scrollEvents:[...this.scrollEvents]}}}}async function r(t,e){if(n())return await async function(t,e){if(!crypto||!crypto.subtle)throw new Error("Web Crypto API n√£o dispon√≠vel");const o=await crypto.subtle.importKey("raw",(new TextEncoder).encode(e),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),n=await crypto.subtle.sign("HMAC",o,(new TextEncoder).encode(t));return btoa(String.fromCharCode(...new Uint8Array(n)))}(t,e);if(o())return function(t,e){try{const o=globalThis.crypto||require("crypto");if(o.createHmac)return o.createHmac("sha256",e).update(t).digest("base64");throw new Error("createHmac n√£o dispon√≠vel")}catch(t){throw new Error("M√≥dulo crypto do Node.js n√£o dispon√≠vel")}}(t,e);throw new Error("Ambiente n√£o suportado para HMAC")}class a{constructor(t={}){this.endpoint=t.endpoint,this.secret=t.secret,this.timeout=t.timeout||5e3,this.retries=t.retries||2}async sendData(t){if(!this.endpoint)throw new Error("Endpoint n√£o configurado");const e=JSON.stringify(t);let o=null;if(this.secret)try{o=await r(e,this.secret)}catch(t){console.warn("Falha ao criar assinatura HMAC:",t.message)}const n={"Content-Type":"application/json"};o&&(n["X-SDK-Signature"]=o);for(let t=0;t<=this.retries;t++)try{const t=await this.makeRequest(this.endpoint,{method:"POST",headers:n,body:e});if(t.ok){return await t.json()}throw new Error(`HTTP ${t.status}: ${t.statusText}`)}catch(e){if(t===this.retries)throw e;await this.delay(1e3*(t+1))}}async makeRequest(t,e){if(n())return await fetch(t,{...e,signal:AbortSignal.timeout(this.timeout)});if(!o())throw new Error("Ambiente n√£o suportado para requisi√ß√µes HTTP");try{const o=globalThis.fetch||require("node-fetch");return await o(t,e)}catch(t){throw new Error("Fetch n√£o dispon√≠vel no Node.js. Instale node-fetch ou use Node.js 18+")}}delay(t){return new Promise((e=>setTimeout(e,t)))}}class c{constructor(t={}){this.options={endpoint:t.endpoint,secret:t.secret,autoCollect:!1!==t.autoCollect,collectInterval:t.collectInterval||3e4,timeout:t.timeout||5e3,retries:t.retries||2,debug:t.debug||!1,...t},this.collector=new s,this.sender=new a({endpoint:this.options.endpoint,secret:this.options.secret,timeout:this.options.timeout,retries:this.options.retries}),this.sessionId=Math.random().toString(36).substr(2,9)+Date.now().toString(36),this.isInitialized=!1,this.collectTimer=null,this.options.debug&&console.log("Veritas inicializado com op√ß√µes:",this.options)}init(){if(!this.isInitialized)return this.isInitialized=!0,this.options.autoCollect&&n()&&this.startAutoCollection(),this.options.debug&&console.log("SDK inicializado com sucesso"),this;console.warn("SDK j√° foi inicializado")}startAutoCollection(){n()?(this.collectTimer&&clearInterval(this.collectTimer),this.collectTimer=setInterval((()=>{this.collectAndSend().catch((t=>{this.options.debug&&console.error("Erro na coleta autom√°tica:",t)}))}),this.options.collectInterval),this.options.debug&&console.log("Coleta autom√°tica iniciada")):console.warn("Coleta autom√°tica dispon√≠vel apenas no browser")}stopAutoCollection(){this.collectTimer&&(clearInterval(this.collectTimer),this.collectTimer=null,this.options.debug&&console.log("Coleta autom√°tica parada"))}collect(){try{const t=this.collector.collectAll();return t.sdkVersion="1.0.0",t.sdkSessionId=this.sessionId,this.options.debug&&console.log("Dados coletados:",t),t}catch(t){throw this.options.debug&&console.error("Erro ao coletar dados:",t),t}}async send(t){if(!this.options.endpoint)throw new Error("Endpoint n√£o configurado");try{const e=await this.sender.sendData(t);return this.options.debug&&console.log("Dados enviados com sucesso:",e),e}catch(t){throw this.options.debug&&console.error("Erro ao enviar dados:",t),t}}async collectAndSend(){const t=this.collect();return await this.send(t)}async checkRisk(t={}){const e=this.collect();return e.action=t,await this.send(e)}destroy(){this.stopAutoCollection(),this.isInitialized=!1,this.options.debug&&console.log("SDK destru√≠do")}configure(t){this.options={...this.options,...t},this.sender=new a({endpoint:this.options.endpoint,secret:this.options.secret,timeout:this.options.timeout,retries:this.options.retries}),this.options.debug&&console.log("SDK reconfigurado:",this.options)}}t.Veritas=c,t.default=c,t.initSDK=function(t={}){return new c(t).init()},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=veritas-sdk.umd.min.js.map

{"version":3,"file":"veritas-sdk.umd.js","sources":["../src/collector.js","../src/utils.js","../src/crypt.js","../src/sender.js","../src/risk.js","../src/index.js"],"sourcesContent":["export function collectData() {\n  const mouseMoves = [];\n  const focusEvents = [];\n\n  // Coletar movimentos do mouse\n  window.addEventListener('mousemove', (e) => {\n    mouseMoves.push({ x: e.clientX, y: e.clientY, t: Date.now() });\n    // Limite para não crescer indefinidamente\n    if (mouseMoves.length > 100) mouseMoves.shift();\n  });\n\n  // Coletar eventos de foco\n  window.addEventListener('focus', (e) => {\n    focusEvents.push({ type: 'focus', t: Date.now() });\n  });\n  window.addEventListener('blur', (e) => {\n    focusEvents.push({ type: 'blur', t: Date.now() });\n  });\n\n  return {\n    userAgent: navigator.userAgent,\n    language: navigator.language,\n    screen: {\n      width: window.screen.width,\n      height: window.screen.height,\n    },\n    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,\n    mouseMoves,\n    focusEvents,\n  };\n}\n","export function isBrowser() {\n  return typeof window !== 'undefined' && typeof window.document !== 'undefined';\n}\n\nexport function isNode() {\n  return typeof process !== 'undefined' && process.versions != null && process.versions.node != null;\n}\n","import { isNode, isBrowser } from './utils.js';\n\n// Implementação HMAC para browser\nasync function browserHmac(message, secret) {\n  if (!crypto || !crypto.subtle) {\n    throw new Error('Web Crypto API não disponível');\n  }\n  \n  const key = await crypto.subtle.importKey(\n    'raw',\n    new TextEncoder().encode(secret),\n    { name: 'HMAC', hash: 'SHA-256' },\n    false,\n    ['sign']\n  );\n  \n  const signature = await crypto.subtle.sign(\n    'HMAC',\n    key,\n    new TextEncoder().encode(message)\n  );\n  \n  return btoa(String.fromCharCode(...new Uint8Array(signature)));\n}\n\n// Implementação HMAC para Node.js\nasync function nodeHmac(message, secret) {\n  try {\n    let crypto;\n    if (typeof require !== 'undefined') {\n      // CommonJS\n      crypto = require('crypto');\n    } else if (typeof process !== 'undefined' && process.versions?.node) {\n      // ESM\n      crypto = (await import('crypto')).default;\n    }\n    if (crypto?.createHmac) {\n      return crypto.createHmac('sha256', secret).update(message).digest('base64');\n    } else {\n      throw new Error('createHmac não disponível');\n    }\n  } catch (error) {\n    throw new Error('Módulo crypto do Node.js não disponível');\n  }\n}\n\n// Função universal para HMAC\nexport async function createHmac(message, secret) {\n  if (isBrowser()) {\n    return await browserHmac(message, secret);\n  } else if (isNode()) {\n    return nodeHmac(message, secret);\n  } else {\n    throw new Error('Ambiente não suportado para HMAC');\n  }\n}\n\n// Verificação de assinatura\nexport async function verifyHmac(message, signature, secret) {\n  try {\n    const expectedSignature = await createHmac(message, secret);\n    return expectedSignature === signature;\n  } catch (error) {\n    return false;\n  }\n}\n\n","import { createHmac } from './crypt.js';\n\nexport async function sendToBackend(data, options) {\n  const signature = await createHmac(JSON.stringify(data), options.secret);\n\n  const response = await fetch(options.endpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-SDK-Signature': signature\n    },\n    body: JSON.stringify(data)\n  });\n\n  return response;\n}\n","const weights = {\n    canvas: 20,\n    webgl: 15,\n    audio: 5,\n    mouseEvents: 25,\n    keyboardEvents: 20,\n    timezoneUTC: 10,\n    highValuePurchase: 30\n};\n\nexport function evaluateRisk(data) {\n    let score = 0;\n    score += !data.fingerprints?.canvas ? weights.canvas : 0;\n    score += !data.fingerprints?.webgl ? weights.webgl : 0;\n    score += !data.fingerprints?.audio ? weights.audio : 0;\n    score += (data.behavior?.mouseEvents?.length < 5) ? weights.mouseEvents : 0;\n    score += (data.behavior?.keyboardEvents?.length < 3) ? weights.keyboardEvents : 0;\n    score += (data.timezone?.timezone === 'UTC') ? weights.timezoneUTC : 0;\n    score += (data.action?.action === 'purchase' && data.action?.amount > 1000) ? weights.highValuePurchase : 0;\n    return Math.min(100, score);\n}\n\nexport function riskDecision(score, data, threshold = 45) {\n    let decision = 'allow';\n    if (score >= threshold) decision = 'deny';\n    else if (score >= threshold * 0.7) decision = 'review';\n    else decision = 'allow';\n\n    const reasons = [];\n    if (score >= 50) reasons.push('Comportamento suspeito detectado');\n    if (!data.fingerprints?.canvas) reasons.push('Fingerprint de canvas ausente');\n    if (data.action?.amount > 1000) reasons.push('Valor de transação alto');\n    return { decision, reasons };\n}","import { collectData } from './collector.js';\nimport { sendToBackend } from './sender.js';\nexport { createHmac, verifyHmac } from './crypt.js';\nexport { evaluateRisk, riskDecision } from './risk.js';\n\n// Classe principal da SDK\nexport class Veritas {\n  constructor(options = {}) {\n    this.options = options;\n  }\n  collect() { return collectData(); }\n  async send(data) { return sendToBackend(data, this.options); }\n  async collectAndSend() {\n    const data = this.collect();\n    return this.send(data);\n  }\n  async checkRisk(actionData) {\n    const data = this.collect();\n    data.action = actionData;\n    const response = await this.send(data);\n    return await response.json();\n  }\n  startAutoCollection() {}\n  stopAutoCollection() {}\n  configure(newOptions) { Object.assign(this.options, newOptions); }\n  destroy() {}\n}\n\n// Função de conveniência\nexport function init(options = {}) {\n  const sdk = new Veritas(options);\n  return sdk;\n}\n\n// Export default para compatibilidade\nexport default Veritas;"],"names":[],"mappings":"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"}